<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QR Scanner</title>
  <script type="module">
    import QrScanner from "https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js";
    let scanner;

    async function startScanner(deviceId) {
      const video = document.getElementById('qr-video');
      if (scanner) {
        scanner.destroy();
      }
      scanner = new QrScanner(video, result => {
        window.location.href = `view.html?id=${result}`;
      }, {
        deviceId: deviceId,
        highlightScanRegion: true,
        highlightCodeOutline: true,
        maxScansPerSecond: 2
      });
      scanner.start();
    }

    window.addEventListener('DOMContentLoaded', async () => {
      const cameraSelect = document.getElementById('camera-select');
      const cameras = await QrScanner.listCameras(true);
      cameras.forEach(camera => {
        const option = document.createElement('option');
        option.value = camera.id;
        option.textContent = camera.label || `カメラ (${camera.id})`;
        cameraSelect.appendChild(option);
      });

      if (cameras.length > 0) {
        startScanner(cameras[0].id);
      }

      cameraSelect.addEventListener('change', () => {
        startScanner(cameraSelect.value);
      });
    });
  </script>
</head>
<body>
  <h2>カメラでQRコードを読み取ってください</h2>
  <label for="camera-select">カメラの選択：</label>
  <select id="camera-select"></select>
  <br>
  <img src="camera_image.png" alt="パビリオン画像" style="width:auto; max-width:100%; height:auto;">
  <video id="qr-video" style="width: 100%; max-width: 400px;" muted></video>
</body>
</html>
