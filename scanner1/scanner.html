<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QRコードスキャナー</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    video { width: 90%; height: auto; border: 2px solid #ccc; }
    #camera-select { display: none; }
    img { width: auto; height: auto; max-height: 200px; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>QRコード読み取り</h1>
  <video id="preview"></video>
  <img src="../images/001.png" alt="クラス画像">
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script>
    const scanner = new Html5Qrcode("preview");

    function startScanner() {
      Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
          scanner.start(
            devices[0].id,
            {
              fps: 10,
              qrbox: 250
            },
            qrCodeMessage => {
              const group = "1";
              const id = qrCodeMessage.replace(/[^0-9]/g, "").padStart(3, "0");
              window.location.href = `view.html?id=${id}&group=${group}`;
              scanner.stop();
            },
            errorMessage => {
              console.warn("読み取り失敗:", errorMessage);
            }
          ).catch(err => {
            console.error("開始時のエラー:", err);
            alert("カメラが起動できません。設定を確認してください。");
          });
        } else {
          alert("カメラが見つかりません。");
        }
      }).catch(err => {
        console.error("カメラ取得失敗:", err);
        alert("カメラの使用が許可されていないか、デバイスが非対応です。");
      });
    }

    startScanner();
  </script>
</body>
</html>
